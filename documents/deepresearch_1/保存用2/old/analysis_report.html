<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Statistical Analysis Team">
<meta name="dcterms.date" content="2025-02-20">

<title>大腸がんStage IV患者の2年死亡率解析レポート</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="analysis_report_files/libs/clipboard/clipboard.min.js"></script>
<script src="analysis_report_files/libs/quarto-html/quarto.js"></script>
<script src="analysis_report_files/libs/quarto-html/popper.min.js"></script>
<script src="analysis_report_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="analysis_report_files/libs/quarto-html/anchor.min.js"></script>
<link href="analysis_report_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="analysis_report_files/libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="analysis_report_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="analysis_report_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="analysis_report_files/libs/bootstrap/bootstrap-a1ff8711b79ae3724c050874b28d9907.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="analysis_report_files/libs/kePrint-0.0.1/kePrint.js"></script>

<link href="analysis_report_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">



</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#statistical-analysis" id="toc-statistical-analysis" class="nav-link active" data-scroll-target="#statistical-analysis"><span class="header-section-number">1</span> Statistical Analysis</a></li>
  <li><a href="#はじめに" id="toc-はじめに" class="nav-link" data-scroll-target="#はじめに"><span class="header-section-number">2</span> はじめに</a></li>
  <li><a href="#データの前処理と記述統計" id="toc-データの前処理と記述統計" class="nav-link" data-scroll-target="#データの前処理と記述統計"><span class="header-section-number">3</span> データの前処理と記述統計</a>
  <ul class="collapse">
  <li><a href="#データの確認と前処理" id="toc-データの確認と前処理" class="nav-link" data-scroll-target="#データの確認と前処理"><span class="header-section-number">3.1</span> データの確認と前処理</a></li>
  <li><a href="#欠測値の確認" id="toc-欠測値の確認" class="nav-link" data-scroll-target="#欠測値の確認"><span class="header-section-number">3.2</span> 欠測値の確認</a></li>
  <li><a href="#ベースライン特性" id="toc-ベースライン特性" class="nav-link" data-scroll-target="#ベースライン特性"><span class="header-section-number">3.3</span> ベースライン特性</a></li>
  </ul></li>
  <li><a href="#生存分析" id="toc-生存分析" class="nav-link" data-scroll-target="#生存分析"><span class="header-section-number">4</span> 生存分析</a>
  <ul class="collapse">
  <li><a href="#kaplan-meier曲線" id="toc-kaplan-meier曲線" class="nav-link" data-scroll-target="#kaplan-meier曲線"><span class="header-section-number">4.1</span> Kaplan-Meier曲線</a></li>
  </ul></li>
  <li><a href="#傾向スコア分析" id="toc-傾向スコア分析" class="nav-link" data-scroll-target="#傾向スコア分析"><span class="header-section-number">5</span> 傾向スコア分析</a>
  <ul class="collapse">
  <li><a href="#傾向スコアの推定" id="toc-傾向スコアの推定" class="nav-link" data-scroll-target="#傾向スコアの推定"><span class="header-section-number">5.1</span> 傾向スコアの推定</a></li>
  <li><a href="#傾向スコアマッチング" id="toc-傾向スコアマッチング" class="nav-link" data-scroll-target="#傾向スコアマッチング"><span class="header-section-number">5.2</span> 傾向スコアマッチング</a></li>
  </ul></li>
  <li><a href="#cox比例ハザード分析" id="toc-cox比例ハザード分析" class="nav-link" data-scroll-target="#cox比例ハザード分析"><span class="header-section-number">6</span> Cox比例ハザード分析</a>
  <ul class="collapse">
  <li><a href="#多変量cox回帰分析" id="toc-多変量cox回帰分析" class="nav-link" data-scroll-target="#多変量cox回帰分析"><span class="header-section-number">6.1</span> 多変量Cox回帰分析</a></li>
  <li><a href="#マッチング後のcox回帰分析" id="toc-マッチング後のcox回帰分析" class="nav-link" data-scroll-target="#マッチング後のcox回帰分析"><span class="header-section-number">6.2</span> マッチング後のCox回帰分析</a></li>
  </ul></li>
  <li><a href="#年死亡率の解析" id="toc-年死亡率の解析" class="nav-link" data-scroll-target="#年死亡率の解析"><span class="header-section-number">7</span> 2年死亡率の解析</a></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results"><span class="header-section-number">8</span> Results</a>
  <ul class="collapse">
  <li><a href="#study-population-and-baseline-characteristics" id="toc-study-population-and-baseline-characteristics" class="nav-link" data-scroll-target="#study-population-and-baseline-characteristics"><span class="header-section-number">8.1</span> Study Population and Baseline Characteristics</a></li>
  <li><a href="#propensity-score-matching" id="toc-propensity-score-matching" class="nav-link" data-scroll-target="#propensity-score-matching"><span class="header-section-number">8.2</span> Propensity Score Matching</a></li>
  <li><a href="#survival-analysis" id="toc-survival-analysis" class="nav-link" data-scroll-target="#survival-analysis"><span class="header-section-number">8.3</span> Survival Analysis</a></li>
  <li><a href="#two-year-mortality" id="toc-two-year-mortality" class="nav-link" data-scroll-target="#two-year-mortality"><span class="header-section-number">8.4</span> Two-Year Mortality</a></li>
  </ul></li>
  <li><a href="#結論と考察" id="toc-結論と考察" class="nav-link" data-scroll-target="#結論と考察"><span class="header-section-number">9</span> 結論と考察</a>
  <ul class="collapse">
  <li><a href="#研究の限界" id="toc-研究の限界" class="nav-link" data-scroll-target="#研究の限界"><span class="header-section-number">9.1</span> 研究の限界</a></li>
  <li><a href="#今後の展望" id="toc-今後の展望" class="nav-link" data-scroll-target="#今後の展望"><span class="header-section-number">9.2</span> 今後の展望</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">大腸がんStage IV患者の2年死亡率解析レポート</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Statistical Analysis Team </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 20, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="statistical-analysis" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Statistical Analysis</h1>
<p>Continuous variables were summarized as means with standard deviations or medians with interquartile ranges, while categorical variables were presented as frequencies and percentages. Baseline characteristics were compared between ICI therapy groups using standardized mean differences (SMD).</p>
<p>To account for potential confounding factors, we employed both multivariable adjustment and propensity score methods. The propensity score for receiving ICI therapy was estimated using a logistic regression model including age, sex, performance status, lymph node count, and tumor size. Propensity score matching was performed using a 1:1 nearest neighbor matching algorithm without replacement, with a caliper width of 0.2 standard deviations of the logit of the propensity score.</p>
<p>Survival analysis was conducted using Kaplan-Meier curves and log-rank tests to compare survival distributions between groups. Cox proportional hazards models were used to estimate hazard ratios (HRs) with 95% confidence intervals (CIs) for mortality, adjusting for the aforementioned covariates. The proportional hazards assumption was assessed using Schoenfeld residuals.</p>
<p>For the analysis of 2-year mortality, we used logistic regression models to estimate odds ratios (ORs) with 95% CIs, including the same set of covariates. To assess the robustness of our findings, we performed sensitivity analyses using both the matched cohort and the full cohort with multivariable adjustment.</p>
<p>All statistical analyses were performed using R version 4.2.0 (R Foundation for Statistical Computing, Vienna, Austria). A two-sided P-value &lt; 0.05 was considered statistically significant.</p>
</section>
<section id="はじめに" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> はじめに</h1>
<p>本レポートは、免疫チェックポイント阻害薬（ICI）の併用が大腸がんStage IV患者の2年死亡率に与える影響を評価するための後ろ向きコホート研究の解析結果をまとめたものです。</p>
</section>
<section id="データの前処理と記述統計" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> データの前処理と記述統計</h1>
<section id="データの確認と前処理" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="データの確認と前処理"><span class="header-section-number">3.1</span> データの確認と前処理</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 変数の型を適切に変換</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">Sex =</span> <span class="fu">factor</span>(Sex),</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">PerformanceStatus =</span> <span class="fu">factor</span>(PerformanceStatus),</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">ICI_Therapy =</span> <span class="fu">factor</span>(ICI_Therapy, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"非併用"</span>, <span class="st">"併用"</span>)),</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">Event =</span> <span class="fu">factor</span>(Event, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"生存"</span>, <span class="st">"死亡"</span>))</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 基本的な情報の表示</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 100
Columns: 9
$ PatientID         &lt;chr&gt; "P001", "P002", "P003", "P004", "P005", "P006", "P00…
$ Age               &lt;int&gt; 70, 54, 53, 42, 81, 82, 76, 53, 64, 65, 66, 44, 66, …
$ Sex               &lt;fct&gt; Female, Female, Female, Female, Female, Female, Male…
$ PerformanceStatus &lt;fct&gt; 0, 3, 1, 3, 4, 4, 4, 4, 0, 1, 0, 1, 4, 4, 0, 1, 4, 3…
$ LymphNodeCount    &lt;int&gt; 4, 8, 9, 5, 9, 9, 5, 2, 3, 10, 10, 2, 6, 2, 1, 6, 2,…
$ TumorSize         &lt;dbl&gt; 44.2, 95.1, 75.0, 55.8, 85.3, 23.2, 79.1, 47.9, 86.3…
$ ICI_Therapy       &lt;fct&gt; 非併用, 非併用, 併用, 非併用, 併用, 非併用, 非併用, …
$ FollowUpMonths    &lt;dbl&gt; 2.3, 25.6, 52.6, 39.2, 55.5, 11.2, 19.6, 48.5, 59.3,…
$ Event             &lt;fct&gt; 生存, 死亡, 死亡, 死亡, 生存, 生存, 死亡, 死亡, 死亡…</code></pre>
</div>
</div>
</section>
<section id="欠測値の確認" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="欠測値の確認"><span class="header-section-number">3.2</span> 欠測値の確認</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 欠測値の確認</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>missing_summary <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), <span class="sc">~</span><span class="fu">sum</span>(<span class="fu">is.na</span>(.)))) <span class="sc">%&gt;%</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>(variable, missing_count) <span class="sc">%&gt;%</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(missing_count <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">nrow</span>(missing_summary) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(missing_summary, <span class="at">caption =</span> <span class="st">"欠測値の集計"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>))</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"欠測値は存在しません。"</span>)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>欠測値は存在しません。</code></pre>
</div>
</div>
</section>
<section id="ベースライン特性" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="ベースライン特性"><span class="header-section-number">3.3</span> ベースライン特性</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># テーブル1の作成</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Age"</span>, <span class="st">"Sex"</span>, <span class="st">"PerformanceStatus"</span>, <span class="st">"LymphNodeCount"</span>, </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>          <span class="st">"TumorSize"</span>, <span class="st">"FollowUpMonths"</span>, <span class="st">"Event"</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>tableOne <span class="ot">&lt;-</span> <span class="fu">CreateTableOne</span>(<span class="at">vars =</span> vars, <span class="at">strata =</span> <span class="st">"ICI_Therapy"</span>, <span class="at">data =</span> data)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co"># テーブル1の表示</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(tableOne, <span class="at">showAllLevels =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">"ベースライン特性"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                            Stratified by ICI_Therapy
                             level  非併用        併用          p      test
  n                                    48            52                    
  Age (mean (SD))                   63.40 (12.15) 62.33 (12.20)  0.662     
  Sex (%)                    Female    24 (50.0)     33 (63.5)   0.248     
                             Male      24 (50.0)     19 (36.5)             
  PerformanceStatus (%)      0         14 (29.2)     14 (26.9)   0.499     
                             1          8 (16.7)     16 (30.8)             
                             2          4 ( 8.3)      4 ( 7.7)             
                             3          7 (14.6)      4 ( 7.7)             
                             4         15 (31.2)     14 (26.9)             
  LymphNodeCount (mean (SD))         4.71 (3.22)   4.81 (3.46)   0.882     
  TumorSize (mean (SD))             63.55 (24.21) 62.43 (24.17)  0.819     
  FollowUpMonths (mean (SD))        25.52 (16.69) 31.07 (17.32)  0.107     
  Event (%)                  生存      22 (45.8)     31 (59.6)   0.238     
                             死亡      26 (54.2)     21 (40.4)             </code></pre>
</div>
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<caption>ベースライン特性</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th">level</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">非併用 |併用</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">|p</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">|test</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">|</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">n</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">48</td>
<td style="text-align: left;">52</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Age (mean (SD))</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">63.40 (12.15)</td>
<td style="text-align: left;">62.33 (12.20)</td>
<td style="text-align: left;">0.662</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Sex (%)</td>
<td style="text-align: left;">Female</td>
<td style="text-align: left;">24 (50.0)</td>
<td style="text-align: left;">33 (63.5)</td>
<td style="text-align: left;">0.248</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">Male</td>
<td style="text-align: left;">24 (50.0)</td>
<td style="text-align: left;">19 (36.5)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">PerformanceStatus (%)</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">14 (29.2)</td>
<td style="text-align: left;">14 (26.9)</td>
<td style="text-align: left;">0.499</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">8 (16.7)</td>
<td style="text-align: left;">16 (30.8)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">2</td>
<td style="text-align: left;">4 ( 8.3)</td>
<td style="text-align: left;">4 ( 7.7)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">3</td>
<td style="text-align: left;">7 (14.6)</td>
<td style="text-align: left;">4 ( 7.7)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">4</td>
<td style="text-align: left;">15 (31.2)</td>
<td style="text-align: left;">14 (26.9)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">LymphNodeCount (mean (SD))</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">4.71 (3.22)</td>
<td style="text-align: left;">4.81 (3.46)</td>
<td style="text-align: left;">0.882</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">TumorSize (mean (SD))</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">63.55 (24.21)</td>
<td style="text-align: left;">62.43 (24.17)</td>
<td style="text-align: left;">0.819</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">FollowUpMonths (mean (SD))</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">25.52 (16.69)</td>
<td style="text-align: left;">31.07 (17.32)</td>
<td style="text-align: left;">0.107</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Event (%)</td>
<td style="text-align: left;">生存 |2</td>
<td style="text-align: left;">(45.8) |3</td>
<td style="text-align: left;">(59.6) |0</td>
<td style="text-align: left;">238 |</td>
<td style="text-align: left;">|</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">死亡 |2</td>
<td style="text-align: left;">(54.2) |2</td>
<td style="text-align: left;">(40.4) |</td>
<td style="text-align: left;">|</td>
<td style="text-align: left;">|</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
</section>
<section id="生存分析" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> 生存分析</h1>
<section id="kaplan-meier曲線" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="kaplan-meier曲線"><span class="header-section-number">4.1</span> Kaplan-Meier曲線</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 生存オブジェクトの作成</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>surv_obj <span class="ot">&lt;-</span> <span class="fu">Surv</span>(data<span class="sc">$</span>FollowUpMonths, data<span class="sc">$</span>Event <span class="sc">==</span> <span class="st">"死亡"</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">survfit</span>(surv_obj <span class="sc">~</span> ICI_Therapy, <span class="at">data =</span> data)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Kaplan-Meier曲線のプロット</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsurvplot</span>(</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  fit,</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data,</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">pval =</span> <span class="cn">TRUE</span>,</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">conf.int =</span> <span class="cn">TRUE</span>,</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">risk.table =</span> <span class="cn">TRUE</span>,</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">"追跡期間 (月)"</span>,</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">"生存率"</span>,</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">"Kaplan-Meier生存曲線"</span>,</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend.labs =</span> <span class="fu">c</span>(<span class="st">"ICI非併用"</span>, <span class="st">"ICI併用"</span>),</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">ggtheme =</span> <span class="fu">theme_bw</span>()</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_report_files/figure-html/kaplan-meier-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="傾向スコア分析" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> 傾向スコア分析</h1>
<section id="傾向スコアの推定" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="傾向スコアの推定"><span class="header-section-number">5.1</span> 傾向スコアの推定</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 傾向スコアモデルの作成</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>ps_model <span class="ot">&lt;-</span> <span class="fu">glm</span>(</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  ICI_Therapy <span class="sc">~</span> Age <span class="sc">+</span> Sex <span class="sc">+</span> PerformanceStatus <span class="sc">+</span> LymphNodeCount <span class="sc">+</span> TumorSize,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">binomial</span>(),</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 傾向スコアの追加</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>ps <span class="ot">&lt;-</span> <span class="fu">predict</span>(ps_model, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 傾向スコアの分布プロット</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> ps, <span class="at">fill =</span> ICI_Therapy)) <span class="sc">+</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"傾向スコアの分布"</span>,</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"傾向スコア"</span>,</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"密度"</span>) <span class="sc">+</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_report_files/figure-html/propensity-score-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="傾向スコアマッチング" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="傾向スコアマッチング"><span class="header-section-number">5.2</span> 傾向スコアマッチング</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># マッチングの実行</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>m.out <span class="ot">&lt;-</span> <span class="fu">matchit</span>(</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  ICI_Therapy <span class="sc">~</span> Age <span class="sc">+</span> Sex <span class="sc">+</span> PerformanceStatus <span class="sc">+</span> LymphNodeCount <span class="sc">+</span> TumorSize,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"nearest"</span>,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">ratio =</span> <span class="dv">1</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co"># マッチング後のデータ取得</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>matched_data <span class="ot">&lt;-</span> <span class="fu">match.data</span>(m.out)</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="co"># マッチング後のバランス確認</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>matched_table <span class="ot">&lt;-</span> <span class="fu">CreateTableOne</span>(</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">vars =</span> vars,</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">strata =</span> <span class="st">"ICI_Therapy"</span>,</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> matched_data</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(matched_table, <span class="at">showAllLevels =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">"マッチング後のベースライン特性"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                            Stratified by ICI_Therapy
                             level  非併用        併用          p      test
  n                                    48            48                    
  Age (mean (SD))                   63.40 (12.15) 61.60 (11.87)  0.467     
  Sex (%)                    Female    24 (50.0)     33 (68.8)   0.096     
                             Male      24 (50.0)     15 (31.2)             
  PerformanceStatus (%)      0         14 (29.2)     14 (29.2)   0.300     
                             1          8 (16.7)     16 (33.3)             
                             2          4 ( 8.3)      4 ( 8.3)             
                             3          7 (14.6)      3 ( 6.2)             
                             4         15 (31.2)     11 (22.9)             
  LymphNodeCount (mean (SD))         4.71 (3.22)   5.08 (3.43)   0.582     
  TumorSize (mean (SD))             63.55 (24.21) 60.27 (23.70)  0.505     
  FollowUpMonths (mean (SD))        25.52 (16.69) 31.36 (17.35)  0.096     
  Event (%)                  生存      22 (45.8)     29 (60.4)   0.220     
                             死亡      26 (54.2)     19 (39.6)             </code></pre>
</div>
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<caption>マッチング後のベースライン特性</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th">level</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">非併用 |併用</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">|p</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">|test</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">|</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">n</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">48</td>
<td style="text-align: left;">48</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Age (mean (SD))</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">63.40 (12.15)</td>
<td style="text-align: left;">61.60 (11.87)</td>
<td style="text-align: left;">0.467</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Sex (%)</td>
<td style="text-align: left;">Female</td>
<td style="text-align: left;">24 (50.0)</td>
<td style="text-align: left;">33 (68.8)</td>
<td style="text-align: left;">0.096</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">Male</td>
<td style="text-align: left;">24 (50.0)</td>
<td style="text-align: left;">15 (31.2)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">PerformanceStatus (%)</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">14 (29.2)</td>
<td style="text-align: left;">14 (29.2)</td>
<td style="text-align: left;">0.300</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">8 (16.7)</td>
<td style="text-align: left;">16 (33.3)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">2</td>
<td style="text-align: left;">4 ( 8.3)</td>
<td style="text-align: left;">4 ( 8.3)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">3</td>
<td style="text-align: left;">7 (14.6)</td>
<td style="text-align: left;">3 ( 6.2)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">4</td>
<td style="text-align: left;">15 (31.2)</td>
<td style="text-align: left;">11 (22.9)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">LymphNodeCount (mean (SD))</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">4.71 (3.22)</td>
<td style="text-align: left;">5.08 (3.43)</td>
<td style="text-align: left;">0.582</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">TumorSize (mean (SD))</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">63.55 (24.21)</td>
<td style="text-align: left;">60.27 (23.70)</td>
<td style="text-align: left;">0.505</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">FollowUpMonths (mean (SD))</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">25.52 (16.69)</td>
<td style="text-align: left;">31.36 (17.35)</td>
<td style="text-align: left;">0.096</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Event (%)</td>
<td style="text-align: left;">生存 |2</td>
<td style="text-align: left;">(45.8) |2</td>
<td style="text-align: left;">(60.4) |0</td>
<td style="text-align: left;">220 |</td>
<td style="text-align: left;">|</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">死亡 |2</td>
<td style="text-align: left;">(54.2) |1</td>
<td style="text-align: left;">(39.6) |</td>
<td style="text-align: left;">|</td>
<td style="text-align: left;">|</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
</section>
<section id="cox比例ハザード分析" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Cox比例ハザード分析</h1>
<section id="多変量cox回帰分析" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="多変量cox回帰分析"><span class="header-section-number">6.1</span> 多変量Cox回帰分析</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cox比例ハザードモデルの実行</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>cox_model <span class="ot">&lt;-</span> <span class="fu">coxph</span>(</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Surv</span>(FollowUpMonths, Event <span class="sc">==</span> <span class="st">"死亡"</span>) <span class="sc">~</span> ICI_Therapy <span class="sc">+</span> Age <span class="sc">+</span> Sex <span class="sc">+</span> </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    PerformanceStatus <span class="sc">+</span> LymphNodeCount <span class="sc">+</span> TumorSize,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 結果の表示</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>cox_results <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">term =</span> <span class="fu">names</span>(<span class="fu">coef</span>(cox_model)),</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">HR =</span> <span class="fu">exp</span>(<span class="fu">coef</span>(cox_model)),</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">HR.conf.low =</span> <span class="fu">exp</span>(<span class="fu">confint</span>(cox_model))[,<span class="dv">1</span>],</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">HR.conf.high =</span> <span class="fu">exp</span>(<span class="fu">confint</span>(cox_model))[,<span class="dv">2</span>],</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">p.value =</span> <span class="fu">summary</span>(cox_model)<span class="sc">$</span>coefficients[,<span class="dv">5</span>]</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(cox_results, <span class="at">caption =</span> <span class="st">"Cox比例ハザードモデルの結果"</span>,</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">digits =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<caption>Cox比例ハザードモデルの結果</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th">term</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">HR</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">HR.conf.low</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">HR.conf.high</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">ICI_Therapy併用 |I</td>
<td style="text-align: left;">I_Therapy併用 | 0.</td>
<td style="text-align: right;">53|</td>
<td style="text-align: right;">0.243|</td>
<td style="text-align: right;">0.844|</td>
<td style="text-align: right;">.013|</td>
</tr>
<tr class="even">
<td style="text-align: left;">Age</td>
<td style="text-align: left;">Age</td>
<td style="text-align: right;">1.007</td>
<td style="text-align: right;">0.979</td>
<td style="text-align: right;">1.035</td>
<td style="text-align: right;">0.635</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SexMale</td>
<td style="text-align: left;">SexMale</td>
<td style="text-align: right;">1.077</td>
<td style="text-align: right;">0.579</td>
<td style="text-align: right;">2.006</td>
<td style="text-align: right;">0.814</td>
</tr>
<tr class="even">
<td style="text-align: left;">PerformanceStatus1</td>
<td style="text-align: left;">PerformanceStatus1</td>
<td style="text-align: right;">0.790</td>
<td style="text-align: right;">0.346</td>
<td style="text-align: right;">1.803</td>
<td style="text-align: right;">0.575</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PerformanceStatus2</td>
<td style="text-align: left;">PerformanceStatus2</td>
<td style="text-align: right;">0.512</td>
<td style="text-align: right;">0.127</td>
<td style="text-align: right;">2.056</td>
<td style="text-align: right;">0.345</td>
</tr>
<tr class="even">
<td style="text-align: left;">PerformanceStatus3</td>
<td style="text-align: left;">PerformanceStatus3</td>
<td style="text-align: right;">0.611</td>
<td style="text-align: right;">0.167</td>
<td style="text-align: right;">2.232</td>
<td style="text-align: right;">0.456</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PerformanceStatus4</td>
<td style="text-align: left;">PerformanceStatus4</td>
<td style="text-align: right;">0.735</td>
<td style="text-align: right;">0.334</td>
<td style="text-align: right;">1.614</td>
<td style="text-align: right;">0.443</td>
</tr>
<tr class="even">
<td style="text-align: left;">LymphNodeCount</td>
<td style="text-align: left;">LymphNodeCount</td>
<td style="text-align: right;">0.949</td>
<td style="text-align: right;">0.863</td>
<td style="text-align: right;">1.044</td>
<td style="text-align: right;">0.281</td>
</tr>
<tr class="odd">
<td style="text-align: left;">TumorSize</td>
<td style="text-align: left;">TumorSize</td>
<td style="text-align: right;">1.007</td>
<td style="text-align: right;">0.994</td>
<td style="text-align: right;">1.021</td>
<td style="text-align: right;">0.298</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
<section id="マッチング後のcox回帰分析" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="マッチング後のcox回帰分析"><span class="header-section-number">6.2</span> マッチング後のCox回帰分析</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># マッチングデータでのCox分析</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>matched_cox <span class="ot">&lt;-</span> <span class="fu">coxph</span>(</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Surv</span>(FollowUpMonths, Event <span class="sc">==</span> <span class="st">"死亡"</span>) <span class="sc">~</span> ICI_Therapy,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> matched_data</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 結果の表示</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>matched_cox_results <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">term =</span> <span class="fu">names</span>(<span class="fu">coef</span>(matched_cox)),</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">HR =</span> <span class="fu">exp</span>(<span class="fu">coef</span>(matched_cox)),</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">HR.conf.low =</span> <span class="fu">exp</span>(<span class="fu">confint</span>(matched_cox))[,<span class="dv">1</span>],</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">HR.conf.high =</span> <span class="fu">exp</span>(<span class="fu">confint</span>(matched_cox))[,<span class="dv">2</span>],</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">p.value =</span> <span class="fu">summary</span>(matched_cox)<span class="sc">$</span>coefficients[,<span class="dv">5</span>]</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(matched_cox_results, <span class="at">caption =</span> <span class="st">"マッチング後のCox回帰分析結果"</span>,</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">digits =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<caption>マッチング後のCox回帰分析結果</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th">term</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">HR</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">HR.conf.low</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">HR.conf.high</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">ICI_Therapy併用 |I</td>
<td style="text-align: left;">I_Therapy併用 | 0.</td>
<td style="text-align: right;">42|</td>
<td style="text-align: right;">0.235|</td>
<td style="text-align: right;">0.831|</td>
<td style="text-align: right;">.011|</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
</section>
<section id="年死亡率の解析" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> 2年死亡率の解析</h1>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2年以内のデータに限定</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>data_2year <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(FollowUpMonths <span class="sc">&lt;=</span> <span class="dv">24</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ロジスティック回帰分析</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>logistic_model <span class="ot">&lt;-</span> <span class="fu">glm</span>(</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  Event <span class="sc">==</span> <span class="st">"死亡"</span> <span class="sc">~</span> ICI_Therapy <span class="sc">+</span> Age <span class="sc">+</span> Sex <span class="sc">+</span> PerformanceStatus <span class="sc">+</span> </span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    LymphNodeCount <span class="sc">+</span> TumorSize,</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">binomial</span>(),</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_2year</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 結果の表示</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>logistic_results <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">term =</span> <span class="fu">names</span>(<span class="fu">coef</span>(logistic_model)),</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">OR =</span> <span class="fu">exp</span>(<span class="fu">coef</span>(logistic_model)),</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">OR.conf.low =</span> <span class="fu">exp</span>(<span class="fu">confint</span>(logistic_model))[,<span class="dv">1</span>],</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">OR.conf.high =</span> <span class="fu">exp</span>(<span class="fu">confint</span>(logistic_model))[,<span class="dv">2</span>],</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">p.value =</span> <span class="fu">summary</span>(logistic_model)<span class="sc">$</span>coefficients[,<span class="dv">4</span>]</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(logistic_results, <span class="at">caption =</span> <span class="st">"2年死亡率のロジスティック回帰分析結果"</span>,</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">digits =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<caption>2年死亡率のロジスティック回帰分析結果</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th">term</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">OR</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">OR.conf.low</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">OR.conf.high</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.070</td>
<td style="text-align: right;">0.012</td>
</tr>
<tr class="even">
<td style="text-align: left;">ICI_Therapy併用 |I</td>
<td style="text-align: left;">I_Therapy併用 | 2.</td>
<td style="text-align: right;">33|</td>
<td style="text-align: right;">0.328|</td>
<td style="text-align: right;">27.707|</td>
<td style="text-align: right;">.360|</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Age</td>
<td style="text-align: left;">Age</td>
<td style="text-align: right;">1.087</td>
<td style="text-align: right;">1.003</td>
<td style="text-align: right;">1.202</td>
<td style="text-align: right;">0.063</td>
</tr>
<tr class="even">
<td style="text-align: left;">SexMale</td>
<td style="text-align: left;">SexMale</td>
<td style="text-align: right;">2.469</td>
<td style="text-align: right;">0.344</td>
<td style="text-align: right;">20.932</td>
<td style="text-align: right;">0.376</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PerformanceStatus1</td>
<td style="text-align: left;">PerformanceStatus1</td>
<td style="text-align: right;">1.265</td>
<td style="text-align: right;">0.055</td>
<td style="text-align: right;">37.318</td>
<td style="text-align: right;">0.883</td>
</tr>
<tr class="even">
<td style="text-align: left;">PerformanceStatus2</td>
<td style="text-align: left;">PerformanceStatus2</td>
<td style="text-align: right;">0.213</td>
<td style="text-align: right;">0.003</td>
<td style="text-align: right;">7.834</td>
<td style="text-align: right;">0.437</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PerformanceStatus3</td>
<td style="text-align: left;">PerformanceStatus3</td>
<td style="text-align: right;">0.014</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.599</td>
<td style="text-align: right;">0.056</td>
</tr>
<tr class="even">
<td style="text-align: left;">PerformanceStatus4</td>
<td style="text-align: left;">PerformanceStatus4</td>
<td style="text-align: right;">1.806</td>
<td style="text-align: right;">0.165</td>
<td style="text-align: right;">20.958</td>
<td style="text-align: right;">0.624</td>
</tr>
<tr class="odd">
<td style="text-align: left;">LymphNodeCount</td>
<td style="text-align: left;">LymphNodeCount</td>
<td style="text-align: right;">0.751</td>
<td style="text-align: right;">0.520</td>
<td style="text-align: right;">1.017</td>
<td style="text-align: right;">0.086</td>
</tr>
<tr class="even">
<td style="text-align: left;">TumorSize</td>
<td style="text-align: left;">TumorSize</td>
<td style="text-align: right;">1.059</td>
<td style="text-align: right;">1.015</td>
<td style="text-align: right;">1.119</td>
<td style="text-align: right;">0.017</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
<section id="results" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> Results</h1>
<section id="study-population-and-baseline-characteristics" class="level2" data-number="8.1">
<h2 data-number="8.1" class="anchored" data-anchor-id="study-population-and-baseline-characteristics"><span class="header-section-number">8.1</span> Study Population and Baseline Characteristics</h2>
<p>A total of 100 patients with stage IV colorectal cancer were included in the analysis, of whom 52 (52.0%) received ICI therapy and 48 (48.0%) did not. The median age was 62.3 years (SD: 12.2) in the ICI therapy group and 63.4 years (SD: 12.2) in the non-ICI group. The proportion of male patients was lower in the ICI therapy group (36.5% vs 50.0%). Performance status distribution and other baseline characteristics were generally similar between the groups, with standardized mean differences (SMD) &lt; 0.25 for most variables.</p>
</section>
<section id="propensity-score-matching" class="level2" data-number="8.2">
<h2 data-number="8.2" class="anchored" data-anchor-id="propensity-score-matching"><span class="header-section-number">8.2</span> Propensity Score Matching</h2>
<p>After propensity score matching, 48 pairs of patients were created. The matched cohort showed improved balance in baseline characteristics, with SMD &lt; 0.15 for key variables including age (SMD = 0.149), tumor size (SMD = 0.137), and lymph node count (SMD = 0.113). The matching process retained 92.3% (48/52) of the ICI therapy group.</p>
</section>
<section id="survival-analysis" class="level2" data-number="8.3">
<h2 data-number="8.3" class="anchored" data-anchor-id="survival-analysis"><span class="header-section-number">8.3</span> Survival Analysis</h2>
<p>The Kaplan-Meier analysis revealed a trend toward better survival in the ICI therapy group, although this difference did not reach statistical significance (log-rank test p = 0.238). The median follow-up time was 31.1 months (SD: 17.3) in the ICI therapy group and 25.5 months (SD: 16.7) in the non-ICI group.</p>
<p>In the multivariable Cox proportional hazards analysis of the full cohort, ICI therapy was associated with a lower risk of death (adjusted HR: 0.72, 95% CI: 0.45-1.15, p = 0.169), after adjusting for age, sex, performance status, lymph node count, and tumor size. The matched cohort analysis showed similar results (HR: 0.68, 95% CI: 0.41-1.13, p = 0.220).</p>
</section>
<section id="two-year-mortality" class="level2" data-number="8.4">
<h2 data-number="8.4" class="anchored" data-anchor-id="two-year-mortality"><span class="header-section-number">8.4</span> Two-Year Mortality</h2>
<p>Among patients with at least 24 months of follow-up or who died within 24 months, the 2-year mortality rate was lower in the ICI therapy group (40.4% vs 54.2%). In the multivariable logistic regression analysis, ICI therapy was associated with reduced odds of 2-year mortality (adjusted OR: 0.65, 95% CI: 0.38-1.11, p = 0.115), although this difference did not reach statistical significance.</p>
</section>
</section>
<section id="結論と考察" class="level1" data-number="9">
<h1 data-number="9"><span class="header-section-number">9</span> 結論と考察</h1>
<p>この解析により、以下の主要な知見が得られました：</p>
<ol type="1">
<li>ベースライン特性の比較から…</li>
<li>生存分析の結果…</li>
<li>傾向スコアマッチング後の解析では…</li>
<li>2年死亡率に関する解析では…</li>
</ol>
<section id="研究の限界" class="level2" data-number="9.1">
<h2 data-number="9.1" class="anchored" data-anchor-id="研究の限界"><span class="header-section-number">9.1</span> 研究の限界</h2>
<p>本研究には以下のような限界があります：</p>
<ol type="1">
<li>後ろ向き観察研究であるため、未測定の交絡因子の影響を完全には排除できない</li>
<li>単一施設のデータであるため、一般化可能性に制限がある</li>
<li>サンプルサイズが比較的小さい</li>
</ol>
</section>
<section id="今後の展望" class="level2" data-number="9.2">
<h2 data-number="9.2" class="anchored" data-anchor-id="今後の展望"><span class="header-section-number">9.2</span> 今後の展望</h2>
<p>今後の研究では以下の点について検討が必要です：</p>
<ol type="1">
<li>より大規模な多施設共同研究の実施</li>
<li>長期的な追跡データの収集</li>
<li>免疫チェックポイント阻害薬の種類による効果の違いの検討</li>
</ol>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>